var N=(B,x,v)=>new Promise((b,g)=>{var o=_=>{try{y(v.next(_))}catch(k){g(k)}},A=_=>{try{y(v.throw(_))}catch(k){g(k)}},y=_=>_.done?b(_.value):Promise.resolve(_.value).then(o,A);y((v=v.apply(B,x)).next())});import{a as U}from"./alarm-CgyBsok7.js";import{_ as X}from"./DepartmentSelect.vue_vue_type_script_setup_true_lang-Dm9VVF2N.js";import{D as j,r as m,o as G,t as e,k as H,R as u,y as C,z as c,M as L,P as a,X as t,a2 as i,a1 as s,q as l,a3 as D,J as K,T as O,U as Q,an as S}from"./index-DofruHnK.js";import"./team-zXSTIE4G.js";const Y={class:"dashboard-container"},Z={class:"filter-container"},ee={key:0,class:"alert-detail"},le={key:0},ae={key:1},te={class:"suppression-desc"},ne={class:"dialog-footer"},ue=j({__name:"AlarmList",setup(B){m(!0),m(!0),m(30);const x=m([]),v=m([]),b=m(!1),g=m(!1);m("email");const o=m(null);m({level:"warning",deviceId:"Device-A-001",metric:"压力",currentValue:"520",threshold:"500",channels:["email","sms"]});const A=m({pageSize:10,pageNumber:1,notification_channels:null,name:null}),y=m([]),_=m(0);m({notification_methods:1,alert_suppression_time:30,recipients:[]}),G(()=>{k();const d=[{id:1,timestamp:Date.now()-3e5,level:"warning",title:e("alarm.warning_level")+e("alarm.title")+" - Device-A-001",message:e("alarm.message_pressure_exceeded"),deviceId:"Device-A-001",metric:"压力",currentValue:"520 kPa",threshold:"500 kPa",channels:["email"],notified:!0,suppressed:!1,suggestion:e("alarm.suggestion_check_transmitter")},{id:2,timestamp:Date.now()-6e5,level:"critical",title:e("alarm.critical_level")+e("alarm.title")+" - Device-B-002",message:e("alarm.message_temperature_abnormal"),deviceId:"Device-B-002",metric:"温度",currentValue:"89.2°C",threshold:"85°C",channels:["email","sms"],notified:!0,suppressed:!1,suggestion:e("alarm.suggestion_check_cooling_system")}];v.value=d,x.value=d});const k=()=>N(null,null,function*(){const{data:d,total:n}=yield U.getAlarmList(A.value);y.value=d,_.value=n}),$=d=>new Date(d).toLocaleString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}).replace(/\//g,"-"),I=d=>N(null,null,function*(){const{data:n}=yield U.getAlarmDetail({id:d.id});o.value=n,b.value=!0});m(!1);const W=()=>{g.value=!0},M=()=>{const d=v.value.filter(n=>n.suppressed);d.length===0?S.info(e("alarm.today_no_suppressed_alerts")):S.info(e("alarm.today_suppressed_count",{count:d.length}))},w=H({channels:["email"],suppressionWindow:30,recipients:[]}),P=()=>{S.success(e("alarm.settings_saved")),g.value=!1};return(d,n)=>{const h=u("el-button"),q=u("el-divider"),p=u("el-table-column"),V=u("el-tag"),E=u("el-table"),f=u("el-descriptions-item"),F=u("el-descriptions"),T=u("el-dialog"),J=u("el-slider"),z=u("el-form-item"),R=u("el-form");return c(),C("div",Y,[L("div",Z,[a(h,{class:"filter-item",onClick:W},{default:t(()=>[i(s(l(e)("alarm.notification_settings")),1)]),_:1}),a(h,{class:"filter-item",onClick:M},{default:t(()=>[i(s(l(e)("alarm.suppression_log")),1)]),_:1})]),a(q,{style:{margin:"6px 0 16px"}}),a(E,{data:y.value,border:""},{default:t(()=>[a(p,{type:"index",label:l(e)("table.serialNumber"),width:"80",align:"center"},null,8,["label"]),a(p,{prop:"alarmType",label:l(e)("alarm.alert_type"),"min-width":"120",align:"center"},null,8,["label"]),a(p,{prop:"code",label:l(e)("alarm.device_code"),"min-width":"150",align:"center"},null,8,["label"]),a(p,{prop:"metric",label:l(e)("alarm.metric"),"min-width":"120",align:"center"},null,8,["label"]),a(p,{prop:"currentValue",label:l(e)("alarm.current_value"),"min-width":"120",align:"center"},null,8,["label"]),a(p,{prop:"threshold",label:l(e)("alarm.threshold"),"min-width":"120",align:"center"},null,8,["label"]),a(p,{prop:"suggestion",label:l(e)("alarm.handling_suggestion"),align:"center","min-width":"220"},null,8,["label"]),a(p,{prop:"status",label:l(e)("alarm.notification_status"),align:"center","min-width":"220"},{default:t(({row:r})=>[r.status===1?(c(),D(V,{key:0,type:"success"},{default:t(()=>[i(s(l(e)("alarm.notified")),1)]),_:1})):(c(),D(V,{key:1,type:"warning"},{default:t(()=>[i(s(l(e)("alarm.not_notified")),1)]),_:1}))]),_:1},8,["label"]),a(p,{label:l(e)("alarm.detail_button"),align:"center",fixed:"right"},{default:t(({row:r})=>[a(h,{size:"small",type:"primary",onClick:se=>I(r)},{default:t(()=>[i(s(l(e)("alarm.detail_button")),1)]),_:1},8,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"]),a(T,{modelValue:b.value,"onUpdate:modelValue":n[2]||(n[2]=r=>b.value=r),title:o.value?o.value.title:l(e)("alarm.alert_detail"),width:"600px"},{footer:t(()=>[a(h,{onClick:n[0]||(n[0]=r=>b.value=!1)},{default:t(()=>[i(s(l(e)("alarm.close_button")),1)]),_:1}),a(h,{type:"primary",onClick:n[1]||(n[1]=r=>b.value=!1)},{default:t(()=>[i(s(l(e)("alarm.confirm_button")),1)]),_:1})]),default:t(()=>[o.value?(c(),C("div",ee,[a(F,{column:2,border:""},{default:t(()=>[a(f,{label:l(e)("alarm.alarm_type")},{default:t(()=>[i(s(o.value.alarmType),1)]),_:1},8,["label"]),a(f,{label:l(e)("alarm.trigger_time")},{default:t(()=>[i(s($(o.value.timestamp)),1)]),_:1},8,["label"]),a(f,{label:l(e)("alarm.device_code")},{default:t(()=>[i(s(o.value.code),1)]),_:1},8,["label"]),a(f,{label:l(e)("alarm.metric")},{default:t(()=>[i(s(o.value.metric),1)]),_:1},8,["label"]),a(f,{label:l(e)("alarm.current_value")},{default:t(()=>[i(s(o.value.currentValue),1)]),_:1},8,["label"]),a(f,{label:l(e)("alarm.threshold")},{default:t(()=>[i(s(o.value.threshold),1)]),_:1},8,["label"]),a(f,{label:l(e)("alarm.notification_status"),span:2},{default:t(()=>[o.value.notified?(c(),D(V,{key:0,type:"success"},{default:t(()=>[i(s(l(e)("alarm.notified")),1)]),_:1})):(c(),D(V,{key:1,type:"info"},{default:t(()=>[i(s(l(e)("alarm.not_notified")),1)]),_:1}))]),_:1},8,["label"]),a(f,{label:l(e)("alarm.notification_channel"),span:2},{default:t(()=>[o.value.channels&&o.value.channels.length>0?(c(),C("div",le,[(c(!0),C(O,null,Q(o.value.channels,r=>(c(),D(V,{key:r,style:{"margin-right":"5px"}},{default:t(()=>[i(s(r==="email"?l(e)("alarm.email"):l(e)("alarm.sms")),1)]),_:2},1024))),128))])):(c(),C("span",ae,s(l(e)("alarm.no_config")),1))]),_:1},8,["label"]),a(f,{label:l(e)("alarm.check_suggestion"),span:2},{default:t(()=>[i(s(o.value.suggestion||l(e)("alarm.default_check_suggestion")),1)]),_:1},8,["label"])]),_:1})])):K("",!0)]),_:1},8,["modelValue","title"]),a(T,{modelValue:g.value,"onUpdate:modelValue":n[6]||(n[6]=r=>g.value=r),title:l(e)("alarm.notification_settings"),width:"600px"},{footer:t(()=>[L("span",ne,[a(h,{onClick:n[5]||(n[5]=r=>g.value=!1)},{default:t(()=>[i(s(l(e)("alarm.cancel_button")),1)]),_:1}),a(h,{type:"primary",onClick:P},{default:t(()=>[i(s(l(e)("alarm.save_settings")),1)]),_:1})])]),default:t(()=>[a(R,{model:w,"label-width":"auto"},{default:t(()=>[a(z,{label:l(e)("alarm.alert_suppression_time")},{default:t(()=>[a(J,{modelValue:w.suppressionWindow,"onUpdate:modelValue":n[3]||(n[3]=r=>w.suppressionWindow=r),min:5,max:120,step:5,"show-input":"","show-input-controls":"","input-size":"small"},null,8,["modelValue"]),L("div",te,s(l(e)("alarm.same_alert_desc")+w.suppressionWindow+l(e)("alarm.same_alert_desc2")),1)]),_:1},8,["label"]),a(z,{label:l(e)("alarm.recipient_department")},{default:t(()=>[a(X,{modelValue:w.department,"onUpdate:modelValue":n[4]||(n[4]=r=>w.department=r),placeholder:l(e)("alarm.select_department")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}});export{ue as default};
