var ce=Object.defineProperty,fe=Object.defineProperties;var ve=Object.getOwnPropertyDescriptors;var H=Object.getOwnPropertySymbols;var ge=Object.prototype.hasOwnProperty,we=Object.prototype.propertyIsEnumerable;var X=(w,d,v)=>d in w?ce(w,d,{enumerable:!0,configurable:!0,writable:!0,value:v}):w[d]=v,E=(w,d)=>{for(var v in d||(d={}))ge.call(d,v)&&X(w,v,d[v]);if(H)for(var v of H(d))we.call(d,v)&&X(w,v,d[v]);return w},z=(w,d)=>fe(w,ve(d));import{_ as be}from"./BaseDialog.vue_vue_type_script_setup_true_lang-PRE88zNh.js";import{A as Ce,k as Y,b as m,j as _e,o as ye,I as p,w as Ve,y as Fe,P as t,Y as l,M as i,$ as c,V as B,X as F,q as De,aG as Re,aj as C,v as Te}from"./index-DlZhamGx.js";const he={class:"filter-container mt-2"},xe={class:"filter-item float-right"},Se={class:"panel"},ke={class:"deviation-info"},Pe={class:"deviation-item"},Me={class:"deviation-item"},Ae={class:"deviation-value"},$e={class:"deviation-item"},Ee={class:"dialog-footer"},ze={class:"panel"},Oe={class:"status-indicator"},Ne={class:"panel"},We={class:"formula-correction"},qe={class:"filter-container"},Ue={class:"dialog-footer"},Ye=Ce({__name:"measurementData",setup(w){Y({name:null,pageNumber:1,pageSize:10});const d=m("meteringData"),R=(()=>{const a=[],e=new Date("2025-06-05T16:52:00");for(let n=0;n<100;n++){const g=new Date(e.getTime()+n*6e4),s=`${g.getFullYear()}/${g.getMonth()+1}/${g.getDate()} ${g.getHours()}:${g.getMinutes().toString().padStart(2,"0")}`;n%10===0?a.push({time:s,dP:.63,gVF:44.49,gasFlowRate:35.33,liquidFlowRate:472.13,oilFlowRate:406.5,pressure:131.92+n%10,temperature:87.52-n%5,waterCut:13.89+n%3,waterFlowRate:66.48+n%5}):a.push({time:s,dP:0,gVF:0,gasFlowRate:0,liquidFlowRate:0,oilFlowRate:0,pressure:130+n%20,temperature:85-n%10,waterCut:0,waterFlowRate:0})}return a})(),y=m([{id:1,time:"2025/6/5 10:30",value:15.6,description:"Morning sample"},{id:2,time:"2025/6/5 14:45",value:12.3,description:"Afternoon sample"},{id:3,time:"2025/6/5 18:20",value:18.7,description:"Evening sample"}]),b=m(!0);m("");const O=m(0),I=m(0),N=m(!1),D=m(!1),x=m(!1),W=m(null),_=Y({value:0}),J={value:[{required:!0,message:"Please enter water cut value",trigger:"blur"},{type:"number",min:0,max:100,message:"Water cut should be between 0-100",trigger:"blur"}]},S=m([]),j=m(),K=_e(()=>O.value>2?"high-deviation":"low-deviation"),Q=()=>{x.value=!1,W.value=null,Object.assign(_,{value:0,description:""}),D.value=!0},Z=a=>{x.value=!0,W.value=a.id,Object.assign(_,{value:a.value,description:a.description}),D.value=!0},ee=a=>{Re.confirm("Are you sure you want to delete this sample?","Confirm Deletion",{confirmButtonText:"Confirm",cancelButtonText:"Cancel",type:"warning"}).then(()=>{const e=y.value.findIndex(n=>n.id===a);e!==-1&&(y.value.splice(e,1),C.success("Deleted successfully"))}).catch(()=>{})},te=()=>{j.value.validate(a=>{if(a){if(x.value){const e=y.value.findIndex(n=>n.id===W.value);e!==-1&&(y.value[e]=z(E({},y.value[e]),{value:_.value,description:_.description}),C.success("Edited successfully"))}else{const e={id:Date.now(),time:new Date().toLocaleString(),value:_.value,description:_.description};y.value.push(e),C.success("Added successfully")}D.value=!1}})},k=()=>{S.value=R.map((a,e)=>{const n=e>=4?R.slice(e-4,e+1).filter(u=>u.waterCut>0).reduce((u,U)=>u+U.waterCut,0)/R.slice(e-4,e+1).filter(u=>u.waterCut>0).length:a.waterCut,g=a.waterCut>0?Math.abs(a.waterCut-n):null,s=e>=4?R.slice(e-4,e+1).filter(u=>u.waterCut>0).map(u=>Math.abs(u.waterCut-n)):null,r=s&&s.filter(u=>u>2).length/s.length>.5,V=a.waterCut>0?Math.max(0,Math.min(100,a.waterCut+(r?g:0))):null;let A=null,T=null;return a.liquidFlowRate>0&&V!==null&&(T=a.liquidFlowRate*V/100,A=a.liquidFlowRate-T),z(E({},a),{rollingAvg:n>0?n:null,deviation:g,comparisonPoints:s,correctionApplied:r&&b.value,waterCutCorrected:V,oilFlowRateCorrected:A,waterFlowRateCorrected:T})}),le()},le=()=>{if(S.value.length>0){const a=S.value[S.value.length-1];O.value=a.deviation||0,a.comparisonPoints&&(I.value=a.comparisonPoints.filter(e=>e>2).length),N.value=a.correctionApplied}},ae=a=>{C.success(`Optimizer ${a?"enabled":"disabled"}`),k()},P=m(!1),q=m([]),oe=[{id:1,dataTime:"2025/6/5 16:52",modifyTime:"2025/6/5 17:05",modifyType:"Auto Correction",changes:[{field:"Water Cut",originalValue:"12.50%",modifiedValue:"13.89%"},{field:"Oil Flow Rate",originalValue:"390.20",modifiedValue:"406.50"},{field:"Water Flow Rate",originalValue:"55.60",modifiedValue:"66.48"}]},{id:2,dataTime:"2025/6/5 17:04",modifyTime:"2025/6/5 17:06",modifyType:"Manual Correction",changes:[{field:"Pressure",originalValue:"200.00",modifiedValue:"212.00"}]}],ie=a=>{const e=oe.find(n=>n.dataTime===a.time);e?q.value=e.changes.map(n=>z(E({},n),{dataTime:e.dataTime,modifyTime:e.modifyTime,modifyType:e.modifyType})):q.value=[{dataTime:a.time,modifyTime:"-",modifyType:"No Correction",field:"-",originalValue:"-",modifiedValue:"-"}],P.value=!0},ne=()=>{k(),C.success("Data refreshed")},re=()=>{C.success("Report export feature to be implemented")},f=Y({field:"",formula:""}),se=()=>{if(!b.value){C.warning("Please enable optimizer first");return}if(!f.field||!f.formula){C.error("Please select correction field and enter correction formula");return}try{C.success(`Formula correction applied: ${f.field} = ${f.formula}`),k()}catch(a){C.error("Formula format error, please check and try again")}},de=()=>{f.field="",f.formula=""},M=m({dateRange:null,content:null});return ye(()=>{k()}),(a,e)=>{const n=p("el-date-picker"),g=p("el-input"),s=p("el-button"),r=p("el-table-column"),V=p("el-table"),A=p("el-tag"),T=p("el-dialog"),u=p("el-tab-pane"),U=p("el-switch"),$=p("el-option"),ue=p("el-select"),h=p("el-form-item"),G=p("el-form"),me=p("el-input-number"),pe=p("el-tabs");return Fe(),Ve("div",null,[t(pe,{modelValue:d.value,"onUpdate:modelValue":e[10]||(e[10]=o=>d.value=o),type:"card"},{default:l(()=>[t(u,{label:"Metering Data",name:"meteringData"},{default:l(()=>[i("div",he,[t(n,{class:"filter-item w300",modelValue:M.value.dateRange,"onUpdate:modelValue":e[0]||(e[0]=o=>M.value.dateRange=o),type:"daterange","range-separator":"To","start-placeholder":"Start Date","end-placeholder":"End Date","value-format":"YYYY-MM-DD"},null,8,["modelValue"]),t(g,{clearable:"",class:"filter-item width",placeholder:"Please enter content",modelValue:M.value.content,"onUpdate:modelValue":e[1]||(e[1]=o=>M.value.content=o)},null,8,["modelValue"]),t(s,{class:"filter-item",type:"primary",onClick:a.getList},{default:l(()=>[...e[11]||(e[11]=[c("Search",-1)])]),_:1},8,["onClick"]),i("div",xe,[t(s,{type:"primary",onClick:ne},{default:l(()=>[...e[12]||(e[12]=[c("Refresh Data",-1)])]),_:1}),t(s,{onClick:re},{default:l(()=>[...e[13]||(e[13]=[c("Export Report",-1)])]),_:1})]),i("div",Se,[e[17]||(e[17]=i("div",{class:"control-label"},"Deviation Comparison Results",-1)),i("div",ke,[i("div",Pe,[i("div",{class:B(["deviation-value",K.value])},F(O.value.toFixed(2))+"%",3),e[14]||(e[14]=i("div",{class:"deviation-label"},"Current Deviation",-1))]),i("div",Me,[i("div",Ae,F(I.value)+"/5",1),e[15]||(e[15]=i("div",{class:"deviation-label"},"High Deviation Points",-1))]),i("div",$e,[i("div",{class:B(["deviation-value",N.value?"high-deviation":"low-deviation"])},F(N.value?"Yes":"No"),3),e[16]||(e[16]=i("div",{class:"deviation-label"},"Correction Applied",-1))])])])]),t(V,{data:De(R),border:""},{default:l(()=>[t(r,{type:"index",label:"No.",width:"60",align:"center"}),t(r,{prop:"time",label:"Time","min-width":"160",align:"center"}),t(r,{prop:"dP",label:"Differential Pressure(dP)","min-width":"100",align:"center"}),t(r,{prop:"gVF",label:"Gas Volume Fraction(gVF)","min-width":"120",align:"center"}),t(r,{prop:"gasFlowRate",label:"Gas Flow Rate","min-width":"100",align:"center"}),t(r,{prop:"liquidFlowRate",label:"Liquid Flow Rate","min-width":"120",align:"center"}),t(r,{prop:"oilFlowRate",label:"Oil Flow Rate","min-width":"100",align:"center"}),t(r,{prop:"pressure",label:"Pressure","min-width":"100",align:"center"}),t(r,{prop:"temperature",label:"Temperature","min-width":"100",align:"center"}),t(r,{prop:"waterCut",label:"Water Cut","min-width":"100",align:"center"},{default:l(o=>[c(F(o.row.waterCut!==null?o.row.waterCut.toFixed(2)+"%":"N/A"),1)]),_:1}),t(r,{prop:"waterFlowRate",label:"Water Flow Rate","min-width":"100",align:"center"}),t(r,{label:"Operations",fixed:"right","min-width":"200",align:"center"},{default:l(o=>[t(s,{size:"small",onClick:L=>ie(o.row)},{default:l(()=>[...e[18]||(e[18]=[c("Correction Records",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),t(T,{modelValue:P.value,"onUpdate:modelValue":e[3]||(e[3]=o=>P.value=o),title:"Correction Record Details",width:"80%"},{footer:l(()=>[i("span",Ee,[t(s,{onClick:e[2]||(e[2]=o=>P.value=!1)},{default:l(()=>[...e[19]||(e[19]=[c("Close",-1)])]),_:1})])]),default:l(()=>[t(V,{data:q.value,border:"",stripe:""},{default:l(()=>[t(r,{prop:"dataTime",label:"Data Time",width:"180",align:"center"}),t(r,{prop:"modifyTime",label:"Modify Time",width:"180",align:"center"}),t(r,{prop:"modifyType",label:"Correction Type",width:"120",align:"center"},{default:l(o=>[t(A,{type:o.row.modifyType==="Manual Correction"?"warning":"success"},{default:l(()=>[c(F(o.row.modifyType),1)]),_:2},1032,["type"])]),_:1}),t(r,{prop:"field",label:"Field",width:"150",align:"center"}),t(r,{prop:"originalValue",label:"Original Data",align:"center"}),t(r,{prop:"modifiedValue",label:"Modified Data",align:"center"})]),_:1},8,["data"])]),_:1},8,["modelValue"])]),_:1}),t(u,{label:"Optimizer Control",name:"control"},{default:l(()=>[i("div",ze,[i("div",Oe,[e[20]||(e[20]=i("div",{class:"control-label"},"Optimizer Status",-1)),i("div",{class:B(["status-dot",b.value?"status-active":"status-inactive"])},null,2),i("span",null,F(b.value?"Enabled":"Disabled"),1)]),t(U,{modelValue:b.value,"onUpdate:modelValue":e[4]||(e[4]=o=>b.value=o),"active-text":"Auto","inactive-text":"Manual",onChange:ae},null,8,["modelValue"])]),i("div",Ne,[e[24]||(e[24]=i("div",{class:"control-label"},"Formula Correction",-1)),i("div",We,[t(G,{model:f,"label-width":"120px"},{default:l(()=>[t(h,{label:"Select Correction Field"},{default:l(()=>[t(ue,{modelValue:f.field,"onUpdate:modelValue":e[5]||(e[5]=o=>f.field=o),placeholder:"Please select field to correct",disabled:!b.value},{default:l(()=>[t($,{label:"Differential Pressure(dP)",value:"dP"}),t($,{label:"Gas Volume Fraction(gVF)",value:"gVF"}),t($,{label:"Water Cut(waterCut)",value:"waterCut"}),t($,{label:"Pressure(pressure)",value:"pressure"})]),_:1},8,["modelValue","disabled"])]),_:1}),t(h,{label:"Correction Formula"},{default:l(()=>[t(g,{modelValue:f.formula,"onUpdate:modelValue":e[6]||(e[6]=o=>f.formula=o),placeholder:"Please enter correction formula, e.g.: x*1.05+2",disabled:!b.value},null,8,["modelValue","disabled"])]),_:1}),t(h,{label:"Formula Description"},{default:l(()=>[...e[21]||(e[21]=[i("div",{class:"formula-description"},[i("p",null,"Supported operators: +, -, *, /, ^"),i("p",null,"Variable x represents original value"),i("p",null,"Example: x*1.05 (increase by 5%), x-2 (decrease by 2 units)")],-1)])]),_:1}),t(h,null,{default:l(()=>[t(s,{type:"primary",onClick:se,disabled:!b.value||!f.field||!f.formula},{default:l(()=>[...e[22]||(e[22]=[c(" Apply Correction ",-1)])]),_:1},8,["disabled"]),t(s,{onClick:de,disabled:!b.value},{default:l(()=>[...e[23]||(e[23]=[c("Reset",-1)])]),_:1},8,["disabled"])]),_:1})]),_:1},8,["model"])])])]),_:1}),t(u,{label:"Water Cut Sample Configuration",name:"configuration"},{default:l(()=>[i("div",qe,[t(s,{type:"primary",onClick:Q},{default:l(()=>[...e[25]||(e[25]=[c("Add Sample",-1)])]),_:1})]),t(V,{data:y.value,border:""},{default:l(()=>[t(r,{type:"index",label:"No.",width:"80",align:"center"}),t(r,{prop:"time",label:"Time","min-width":"200",align:"center"}),t(r,{prop:"value",label:"Water Cut(%)","min-width":"150",align:"center"},{default:l(o=>[c(F(o.row.value.toFixed(2))+"% ",1)]),_:1}),t(r,{label:"Operations","min-width":"200",align:"center",fixed:"right"},{default:l(o=>[t(s,{size:"small",onClick:L=>Z(o.row)},{default:l(()=>[...e[26]||(e[26]=[c("Edit",-1)])]),_:1},8,["onClick"]),t(s,{size:"small",type:"danger",onClick:L=>ee(o.row.id)},{default:l(()=>[...e[27]||(e[27]=[c("Delete",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),t(be,{modelValue:D.value,"onUpdate:modelValue":e[9]||(e[9]=o=>D.value=o),title:x.value?"Edit Sample":"Add Sample",width:"500px"},{footer:l(()=>[i("div",Ue,[t(s,{onClick:e[8]||(e[8]=o=>D.value=!1)},{default:l(()=>[...e[28]||(e[28]=[c("Cancel",-1)])]),_:1}),t(s,{type:"primary",onClick:te},{default:l(()=>[...e[29]||(e[29]=[c("Confirm",-1)])]),_:1})])]),default:l(()=>[t(G,{model:_,rules:J,ref_key:"sampleFormRef",ref:j,"label-width":"100px"},{default:l(()=>[t(h,{label:"Water Cut(%)",prop:"value"},{default:l(()=>[t(me,{modelValue:_.value,"onUpdate:modelValue":e[7]||(e[7]=o=>_.value=o),precision:2,step:.1,min:0,max:100,"controls-position":"right",style:{width:"100%"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])]),_:1})]),_:1},8,["modelValue"])])}}}),Ge=Te(Ye,[["__scopeId","data-v-4fa39091"]]);export{Ge as default};
