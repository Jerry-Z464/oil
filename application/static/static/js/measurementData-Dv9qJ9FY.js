var ce=Object.defineProperty,pe=Object.defineProperties;var _e=Object.getOwnPropertyDescriptors;var X=Object.getOwnPropertySymbols;var we=Object.prototype.hasOwnProperty,fe=Object.prototype.propertyIsEnumerable;var G=(g,p,d)=>p in g?ce(g,p,{enumerable:!0,configurable:!0,writable:!0,value:d}):g[p]=d,M=(g,p)=>{for(var d in p||(p={}))we.call(p,d)&&G(g,d,p[d]);if(X)for(var d of X(p))fe.call(p,d)&&G(g,d,p[d]);return g},A=(g,p)=>pe(g,_e(p));import{_ as ve}from"./BaseDialog.vue_vue_type_script_setup_true_lang-1kYJ3j0E.js";import{D as ge,k as I,r as _,t as e,j as be,o as Fe,R as w,y as Re,z as he,P as a,X as o,q as t,M as n,a1 as s,W as j,a2 as f,aK as Ce,an as F,w as Ve}from"./index-DofruHnK.js";const ye={class:"panel"},qe={class:"control-label"},xe={class:"deviation-info"},Te={class:"deviation-item"},Pe={class:"deviation-label"},De={class:"deviation-item"},ke={class:"deviation-value"},ze={class:"deviation-label"},Se={class:"deviation-item"},Me={class:"deviation-label"},Ae={class:"mt-2 mb-2 float-right"},Ne={class:"dialog-footer"},Ue={class:"panel"},Be={class:"status-indicator"},Ee={class:"control-label"},$e={class:"panel"},Ie={class:"control-label"},je={class:"formula-correction"},Oe={class:"formula-description"},We={class:"filter-container"},Ke={class:"dialog-footer"},Le=ge({__name:"measurementData",setup(g){I({name:null,pageNumber:1,pageSize:10});const p=_("meteringData"),d=[{time:"2025/6/5 16:52",dP:.63,gVF:44.49,gasFlowRate:35.33,liquidFlowRate:472.13,oilFlowRate:406.5,pressure:131.92,temperature:87.52,waterCut:13.89,waterFlowRate:66.48},{time:"2025/6/5 16:53",dP:0,gVF:0,gasFlowRate:0,liquidFlowRate:0,oilFlowRate:0,pressure:133,temperature:87.01,waterCut:0,waterFlowRate:0},{time:"2025/6/5 16:54",dP:0,gVF:0,gasFlowRate:0,liquidFlowRate:0,oilFlowRate:0,pressure:137,temperature:86.18,waterCut:0,waterFlowRate:0},{time:"2025/6/5 16:55",dP:0,gVF:0,gasFlowRate:0,liquidFlowRate:0,oilFlowRate:0,pressure:141,temperature:86.36,waterCut:0,waterFlowRate:0},{time:"2025/6/5 16:56",dP:0,gVF:0,gasFlowRate:0,liquidFlowRate:0,oilFlowRate:0,pressure:146,temperature:85.62,waterCut:0,waterFlowRate:0},{time:"2025/6/5 16:57",dP:0,gVF:0,gasFlowRate:0,liquidFlowRate:0,oilFlowRate:0,pressure:150,temperature:85.17,waterCut:0,waterFlowRate:0},{time:"2025/6/5 16:58",dP:0,gVF:0,gasFlowRate:0,liquidFlowRate:0,oilFlowRate:0,pressure:154,temperature:85.15,waterCut:0,waterFlowRate:0},{time:"2025/6/5 16:59",dP:0,gVF:0,gasFlowRate:0,liquidFlowRate:0,oilFlowRate:0,pressure:159,temperature:84.64,waterCut:0,waterFlowRate:0},{time:"2025/6/5 17:00",dP:0,gVF:0,gasFlowRate:0,liquidFlowRate:0,oilFlowRate:0,pressure:165,temperature:84.51,waterCut:0,waterFlowRate:0},{time:"2025/6/5 17:01",dP:0,gVF:0,gasFlowRate:0,liquidFlowRate:0,oilFlowRate:0,pressure:170,temperature:84.23,waterCut:0,waterFlowRate:0},{time:"2025/6/5 17:02",dP:0,gVF:0,gasFlowRate:0,liquidFlowRate:0,oilFlowRate:0,pressure:175,temperature:83.54,waterCut:0,waterFlowRate:0},{time:"2025/6/5 17:03",dP:0,gVF:0,gasFlowRate:0,liquidFlowRate:0,oilFlowRate:0,pressure:184,temperature:83.65,waterCut:0,waterFlowRate:0},{time:"2025/6/5 17:04",dP:0,gVF:0,gasFlowRate:0,liquidFlowRate:0,oilFlowRate:0,pressure:212,temperature:83.44,waterCut:0,waterFlowRate:0},{time:"2025/6/5 17:05",dP:0,gVF:0,gasFlowRate:0,liquidFlowRate:0,oilFlowRate:0,pressure:196,temperature:83.26,waterCut:0,waterFlowRate:0},{time:"2025/6/5 17:06",dP:0,gVF:0,gasFlowRate:0,liquidFlowRate:0,oilFlowRate:0,pressure:192,temperature:82.85,waterCut:0,waterFlowRate:0},{time:"2025/6/5 17:07",dP:0,gVF:0,gasFlowRate:0,liquidFlowRate:0,oilFlowRate:0,pressure:194,temperature:82.92,waterCut:0,waterFlowRate:0},{time:"2025/6/5 17:08",dP:0,gVF:0,gasFlowRate:0,liquidFlowRate:0,oilFlowRate:0,pressure:199,temperature:82.97,waterCut:0,waterFlowRate:0},{time:"2025/6/5 17:09",dP:0,gVF:0,gasFlowRate:0,liquidFlowRate:0,oilFlowRate:0,pressure:206,temperature:82.66,waterCut:0,waterFlowRate:0}],C=_([{id:1,time:"2025/6/5 10:30",value:15.6,description:e("measurement.morning_sample")},{id:2,time:"2025/6/5 14:45",value:12.3,description:e("measurement.afternoon_sample")},{id:3,time:"2025/6/5 18:20",value:18.7,description:e("measurement.evening_sample")}]),b=_(!0);_("");const N=_(0),O=_(0),U=_(!1),V=_(!1),P=_(!1),B=_(null),R=I({value:0}),H={value:[{required:!0,message:e("measurement.validation_watercut_required"),trigger:"blur"},{type:"number",min:0,max:100,message:e("measurement.validation_watercut_range"),trigger:"blur"}]},D=_([]),W=_(),J=be(()=>N.value>2?"high-deviation":"low-deviation"),Q=()=>{P.value=!1,B.value=null,Object.assign(R,{value:0,description:""}),V.value=!0},Y=r=>{P.value=!0,B.value=r.id,Object.assign(R,{value:r.value,description:r.description}),V.value=!0},Z=r=>{Ce.confirm(e("measurement.confirm_delete_sample"),e("measurement.confirm_delete"),{confirmButtonText:e("measurement.confirm_button"),cancelButtonText:e("measurement.cancel_button"),type:"warning"}).then(()=>{const l=C.value.findIndex(m=>m.id===r);l!==-1&&(C.value.splice(l,1),F.success(e("measurement.delete_success")))}).catch(()=>{})},ee=()=>{W.value.validate(r=>{if(r){if(P.value){const l=C.value.findIndex(m=>m.id===B.value);l!==-1&&(C.value[l]=A(M({},C.value[l]),{value:R.value,description:R.description}),F.success(e("measurement.edit_success")))}else{const l={id:Date.now(),time:new Date().toLocaleString(),value:R.value,description:R.description};C.value.push(l),F.success(e("measurement.add_success"))}V.value=!1}})},k=()=>{D.value=d.map((r,l)=>{const m=l>=4?d.slice(l-4,l+1).filter(c=>c.waterCut>0).reduce((c,$)=>c+$.waterCut,0)/d.slice(l-4,l+1).filter(c=>c.waterCut>0).length:r.waterCut,u=r.waterCut>0?Math.abs(r.waterCut-m):null,h=l>=4?d.slice(l-4,l+1).filter(c=>c.waterCut>0).map(c=>Math.abs(c.waterCut-m)):null,S=h&&h.filter(c=>c>2).length/h.length>.5,q=r.waterCut>0?Math.max(0,Math.min(100,r.waterCut+(S?u:0))):null;let y=null,x=null;return r.liquidFlowRate>0&&q!==null&&(x=r.liquidFlowRate*q/100,y=r.liquidFlowRate-x),A(M({},r),{rollingAvg:m>0?m:null,deviation:u,comparisonPoints:h,correctionApplied:S&&b.value,waterCutCorrected:q,oilFlowRateCorrected:y,waterFlowRateCorrected:x})}),te()},te=()=>{if(D.value.length>0){const r=D.value[D.value.length-1];N.value=r.deviation||0,r.comparisonPoints&&(O.value=r.comparisonPoints.filter(l=>l>2).length),U.value=r.correctionApplied}},ae=r=>{F.success(e(r?"measurement.optimizer_enabled":"measurement.optimizer_disabled")),k()},z=_(!1),E=_([]),le=[{id:1,dataTime:"2025/6/5 16:52",modifyTime:"2025/6/5 17:05",modifyType:e("measurement.auto_correction"),changes:[{field:e("measurement.watercut_field"),originalValue:"12.50%",modifiedValue:"13.89%"},{field:e("measurement.oil_flow_rate_field"),originalValue:"390.20",modifiedValue:"406.50"},{field:e("measurement.water_flow_rate_field"),originalValue:"55.60",modifiedValue:"66.48"}]},{id:2,dataTime:"2025/6/5 17:04",modifyTime:"2025/6/5 17:06",modifyType:e("measurement.manual_correction"),changes:[{field:e("measurement.pressure_field"),originalValue:"200.00",modifiedValue:"212.00"}]}],oe=r=>{const l=le.find(m=>m.dataTime===r.time);l?E.value=l.changes.map(m=>A(M({},m),{dataTime:l.dataTime,modifyTime:l.modifyTime,modifyType:l.modifyType})):E.value=[{dataTime:r.time,modifyTime:"-",modifyType:e("measurement.no_correction"),field:"-",originalValue:"-",modifiedValue:"-"}],z.value=!0},re=()=>{k(),F.success(e("measurement.data_refreshed"))},ie=()=>{F.success(e("measurement.export_report_pending"))},v=I({field:"",formula:""}),ne=()=>{if(!b.value){F.warning(e("measurement.enable_optimizer_first"));return}if(!v.field||!v.formula){F.error(e("measurement.select_field_and_formula"));return}try{F.success(e("measurement.formula_applied",{field:v.field,formula:v.formula})),k()}catch(r){F.error(e("measurement.formula_format_error"))}},se=()=>{v.field="",v.formula=""};return Fe(()=>{k()}),(r,l)=>{const m=w("el-button"),u=w("el-table-column"),h=w("el-table"),S=w("el-tag"),q=w("el-dialog"),y=w("el-tab-pane"),x=w("el-switch"),c=w("el-option"),$=w("el-select"),T=w("el-form-item"),ue=w("el-input"),K=w("el-form"),me=w("el-input-number"),de=w("el-tabs");return he(),Re("div",null,[a(de,{modelValue:p.value,"onUpdate:modelValue":l[8]||(l[8]=i=>p.value=i),type:"card"},{default:o(()=>[a(y,{label:t(e)("measurement.metering_data"),name:"meteringData"},{default:o(()=>[n("div",ye,[n("div",qe,s(t(e)("measurement.deviation_comparison_result")),1),n("div",xe,[n("div",Te,[n("div",{class:j(["deviation-value",J.value])},s(N.value.toFixed(2))+"%",3),n("div",Pe,s(t(e)("measurement.current_deviation")),1)]),n("div",De,[n("div",ke,s(O.value)+"/5",1),n("div",ze,s(t(e)("measurement.high_deviation_points")),1)]),n("div",Se,[n("div",{class:j(["deviation-value",U.value?"high-deviation":"low-deviation"])},s(U.value?t(e)("measurement.yes"):t(e)("measurement.no")),3),n("div",Me,s(t(e)("measurement.correction_applied")),1)])])]),n("div",Ae,[a(m,{type:"primary",size:"small",onClick:re},{default:o(()=>[f(s(t(e)("measurement.refresh_data")),1)]),_:1}),a(m,{size:"small",onClick:ie},{default:o(()=>[f(s(t(e)("measurement.export_report")),1)]),_:1})]),a(h,{data:d,border:""},{default:o(()=>[a(u,{type:"index",label:t(e)("table.serialNumber"),width:"60",align:"center"},null,8,["label"]),a(u,{prop:"time",label:t(e)("measurement.time"),"min-width":"160",align:"center"},null,8,["label"]),a(u,{prop:"dP",label:t(e)("measurement.differential_pressure"),"min-width":"100",align:"center"},null,8,["label"]),a(u,{prop:"gVF",label:t(e)("measurement.gas_liquid_ratio"),"min-width":"120",align:"center"},null,8,["label"]),a(u,{prop:"gasFlowRate",label:t(e)("measurement.gas_flow_rate"),"min-width":"100",align:"center"},null,8,["label"]),a(u,{prop:"liquidFlowRate",label:t(e)("measurement.liquid_flow_rate"),"min-width":"120",align:"center"},null,8,["label"]),a(u,{prop:"oilFlowRate",label:t(e)("measurement.oil_flow_rate"),"min-width":"100",align:"center"},null,8,["label"]),a(u,{prop:"pressure",label:t(e)("measurement.pressure"),"min-width":"100",align:"center"},null,8,["label"]),a(u,{prop:"temperature",label:t(e)("measurement.temperature"),"min-width":"100",align:"center"},null,8,["label"]),a(u,{prop:"waterCut",label:t(e)("measurement.water_cut"),"min-width":"100",align:"center"},{default:o(i=>[f(s(i.row.waterCut!==null?i.row.waterCut.toFixed(2)+"%":t(e)("measurement.n_a")),1)]),_:1},8,["label"]),a(u,{prop:"waterFlowRate",label:t(e)("measurement.water_flow_rate"),"min-width":"100",align:"center"},null,8,["label"]),a(u,{label:t(e)("measurement.operations"),fixed:"right","min-width":"200",align:"center"},{default:o(i=>[a(m,{size:"small",onClick:L=>oe(i.row)},{default:o(()=>[f(s(t(e)("measurement.correction_records")),1)]),_:1},8,["onClick"])]),_:1},8,["label"])]),_:1}),a(q,{modelValue:z.value,"onUpdate:modelValue":l[1]||(l[1]=i=>z.value=i),title:t(e)("measurement.correction_record_details"),width:"80%"},{footer:o(()=>[n("span",Ne,[a(m,{onClick:l[0]||(l[0]=i=>z.value=!1)},{default:o(()=>[f(s(t(e)("measurement.close")),1)]),_:1})])]),default:o(()=>[a(h,{data:E.value,border:"",stripe:""},{default:o(()=>[a(u,{prop:"dataTime",label:t(e)("measurement.data_time"),width:"180",align:"center"},null,8,["label"]),a(u,{prop:"modifyTime",label:t(e)("measurement.modification_time"),width:"180",align:"center"},null,8,["label"]),a(u,{prop:"modifyType",label:t(e)("measurement.correction_type"),width:"120",align:"center"},{default:o(i=>[a(S,{type:i.row.modifyType===t(e)("measurement.manual_correction")?"warning":"success"},{default:o(()=>[f(s(i.row.modifyType),1)]),_:2},1032,["type"])]),_:1},8,["label"]),a(u,{prop:"field",label:t(e)("measurement.field"),width:"150",align:"center"},null,8,["label"]),a(u,{prop:"originalValue",label:t(e)("measurement.original_data"),align:"center"},null,8,["label"]),a(u,{prop:"modifiedValue",label:t(e)("measurement.modified_data"),align:"center"},null,8,["label"])]),_:1},8,["data"])]),_:1},8,["modelValue","title"])]),_:1},8,["label"]),a(y,{label:t(e)("measurement.optimizer_control"),name:"control"},{default:o(()=>[n("div",Ue,[n("div",Be,[n("div",Ee,s(t(e)("measurement.optimizer_status")),1),n("div",{class:j(["status-dot",b.value?"status-active":"status-inactive"])},null,2),n("span",null,s(b.value?t(e)("measurement.enabled"):t(e)("measurement.disabled")),1)]),a(x,{modelValue:b.value,"onUpdate:modelValue":l[2]||(l[2]=i=>b.value=i),"active-text":t(e)("measurement.automatic"),"inactive-text":t(e)("measurement.manual"),onChange:ae},null,8,["modelValue","active-text","inactive-text"])]),n("div",$e,[n("div",Ie,s(t(e)("measurement.formula_correction")),1),n("div",je,[a(K,{model:v,"label-width":"120px"},{default:o(()=>[a(T,{label:t(e)("measurement.select_correction_field")},{default:o(()=>[a($,{modelValue:v.field,"onUpdate:modelValue":l[3]||(l[3]=i=>v.field=i),placeholder:t(e)("measurement.select_correction_field_placeholder"),disabled:!b.value},{default:o(()=>[a(c,{label:t(e)("measurement.differential_pressure"),value:"dP"},null,8,["label"]),a(c,{label:t(e)("measurement.gas_liquid_ratio"),value:"gVF"},null,8,["label"]),a(c,{label:t(e)("measurement.water_cut"),value:"waterCut"},null,8,["label"]),a(c,{label:t(e)("measurement.pressure"),value:"pressure"},null,8,["label"])]),_:1},8,["modelValue","placeholder","disabled"])]),_:1},8,["label"]),a(T,{label:t(e)("measurement.correction_formula")},{default:o(()=>[a(ue,{modelValue:v.formula,"onUpdate:modelValue":l[4]||(l[4]=i=>v.formula=i),placeholder:t(e)("measurement.correction_formula_placeholder"),disabled:!b.value},null,8,["modelValue","placeholder","disabled"])]),_:1},8,["label"]),a(T,{label:t(e)("measurement.formula_description_label")},{default:o(()=>[n("div",Oe,[n("p",null,s(t(e)("measurement.supported_operators")),1),n("p",null,s(t(e)("measurement.variable_x_explanation")),1),n("p",null,s(t(e)("measurement.example_explanation")),1)])]),_:1},8,["label"]),a(T,null,{default:o(()=>[a(m,{type:"primary",onClick:ne,disabled:!b.value||!v.field||!v.formula},{default:o(()=>[f(s(t(e)("measurement.apply_correction")),1)]),_:1},8,["disabled"]),a(m,{onClick:se,disabled:!b.value},{default:o(()=>[f(s(t(e)("measurement.reset")),1)]),_:1},8,["disabled"])]),_:1})]),_:1},8,["model"])])])]),_:1},8,["label"]),a(y,{label:t(e)("measurement.watercut_sample_configuration"),name:"configuration"},{default:o(()=>[n("div",We,[a(m,{type:"primary",onClick:Q},{default:o(()=>[f(s(t(e)("measurement.add_sample")),1)]),_:1})]),a(h,{data:C.value,border:""},{default:o(()=>[a(u,{type:"index",label:t(e)("table.serialNumber"),width:"80",align:"center"},null,8,["label"]),a(u,{prop:"time",label:t(e)("measurement.time"),"min-width":"200",align:"center"},null,8,["label"]),a(u,{prop:"value",label:t(e)("measurement.watercut_percentage"),"min-width":"150",align:"center"},{default:o(i=>[f(s(i.row.value.toFixed(2))+"% ",1)]),_:1},8,["label"]),a(u,{label:t(e)("measurement.operations"),"min-width":"200",align:"center",fixed:"right"},{default:o(i=>[a(m,{size:"small",onClick:L=>Y(i.row)},{default:o(()=>[f(s(t(e)("measurement.edit")),1)]),_:1},8,["onClick"]),a(m,{size:"small",type:"danger",onClick:L=>Z(i.row.id)},{default:o(()=>[f(s(t(e)("measurement.delete")),1)]),_:1},8,["onClick"])]),_:1},8,["label"])]),_:1},8,["data"]),a(ve,{modelValue:V.value,"onUpdate:modelValue":l[7]||(l[7]=i=>V.value=i),title:P.value?t(e)("measurement.edit_sample"):t(e)("measurement.add_sample"),width:"500px"},{footer:o(()=>[n("div",Ke,[a(m,{onClick:l[6]||(l[6]=i=>V.value=!1)},{default:o(()=>[f(s(t(e)("measurement.cancel")),1)]),_:1}),a(m,{type:"primary",onClick:ee},{default:o(()=>[f(s(t(e)("measurement.confirm")),1)]),_:1})])]),default:o(()=>[a(K,{model:R,rules:H,ref_key:"sampleFormRef",ref:W,"label-width":"auto"},{default:o(()=>[a(T,{label:t(e)("measurement.watercut_percentage"),prop:"value"},{default:o(()=>[a(me,{modelValue:R.value,"onUpdate:modelValue":l[5]||(l[5]=i=>R.value=i),precision:2,step:.1,min:0,max:100,"controls-position":"right",style:{width:"100%"}},null,8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model"])]),_:1},8,["modelValue","title"])]),_:1},8,["label"])]),_:1},8,["modelValue"])])}}}),Je=Ve(Le,[["__scopeId","data-v-5f350e98"]]);export{Je as default};
